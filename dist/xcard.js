(function(){var t=this;(function(){(function(){this.XCard={VERSION:"0.0.1",config:{maxCellsPerRow:12,classPrefix:"xcard"}}}).call(this)}).call(t);var o=t.XCard;(function(){(function(){o.extend=function(t){var o,s;for(o in t)s=t[o],this[o]=s;return this}}).call(this),function(){o.extend({elementToString:function(t,s){var n;return null==s&&(s={}),n=o.makeElement(t,s),n.outerHTML},makeElement:function(t,o){var s,n,i,e,l,r,c,a,h,u;if(null==o&&(o={}),n=document.createElement(t),o.attributes){r=o.attributes;for(e in r)u=r[e],n.setAttribute(e,u)}if(o.style){c=o.style;for(e in c)u=c[e],n.style[e]=u}if(o.data){a=o.data;for(e in a)u=a[e],n.dataset[e]=u}if(o.className)for(h=o.className.split(" "),i=0,l=h.length;l>i;i++)s=h[i],n.classList.add(s);return o.textContent&&(n.textContent=o.textContent),o.colSpan&&n.setAttribute("colspan",o.colSpan),n}})}.call(this),function(){o.chunkArray=function(t,o){var s,n,i;if(0===t.length||1===o)return t;for(s=[],n=0,i=t.length;i>n;)s.push(t.slice(n,n+=o));return s}}.call(this),function(){o.extend({uniqueArray:function(t){var o,s,n,i;for(n={},s=0,i=t.length;i>s;s++)o=t[s],n[""+o+typeof o]=o;return Object.keys(n).map(function(t){return n[t]})}})}.call(this),function(){}.call(this),function(){o.DistanceBlock=function(){function t(t,s){var n;if(null==t&&(t={}),this.endsScoreData=null!=s?s:{},this.options=Object.assign({element:"tbody",config:null},t),null==this.options.config)throw"Distance configuration is required";this.config=this.options.config,this.totalizer=null!=(n=this.options.totalizer)?n:new o.Totalizer({config:this.config}),this.configureBlock()}return t.prototype.configureBlock=function(){var t,s,n;for(this.chunkedEndsScoreData=o.chunkArray(this.endsScoreData,this.config.endsPerRow),this.rows=[new o.DistanceHeaderRow({config:this.config})],s=t=1,n=this.config.rowCount;n>=1?n>=t:t>=n;s=n>=1?++t:--t)this.rows.push(new o.ScoringRow({config:this.config,totals:this.totalizer},this.chunkedEndsScoreData[s-1]));return this.rows.push(new o.DistanceTotalsRow({config:this.config,totals:this.totalizer,cellSpan:this.config.titleCellSpan}))},t.prototype.toHtml=function(){var t,o,s,n,i;for(t=document.createElement(this.options.element),i=this.rows,o=0,s=i.length;s>o;o++)n=i[o],t.appendChild(n.toHtml());return t},t}()}.call(this),function(){o.BasicElement=function(){function t(t,o){null==t&&(t={}),this.element=null!=o?o:"td",this.attributes={},this.setAttributes(t)}return t.prototype.className=function(t){var s;return s=null!=t?t:this.constructor.name.toLowerCase(),o.config.classPrefix+"-"+s},t.prototype.setAttributes=function(t){return null==t&&(t={}),this.attributes=Object.assign(this.attributes,t)},t.prototype.toHtmlString=function(){return o.elementToString(this.element,this.ensureClassnames(this.attributes))},t.prototype.toHtml=function(){return o.makeElement(this.element,this.ensureClassnames(this.attributes))},t.prototype.ensureClassnames=function(t){var s,n;return null==t&&(t={}),s=null!=t.className?t.className.split(" "):[],n=o.uniqueArray(s).sort(),t.className=n.join(" "),t},t}()}.call(this),function(){o.BasicDistanceRow=function(){function t(t,o){this.shotsPerEnd=t,null==o&&(o={}),this.options=Object.assign({withHits:!0,withGolds:!0,withPoints:!1,withX:!1,goldsDescriptor:"g",hitsDescriptor:"h",xDescriptor:"x"},o),this.buildCells()}return t.prototype.buildCells=function(){var t,s,n,i,e,l,r,c;for(this.cells=[],r=this.getScoringCellsPerRow(),t=this.getEndsPerRow(),c=s=1,i=r/t;i>=1?i>=s:s>=i;c=i>=1?++s:--s){for(l=n=1,e=t;e>=1?e>=n:n>=e;l=e>=1?++n:--n)this.cells.push(new o.ScoreCell);this.cells.push(new o.EndTotalCell)}return this.renderHits()&&this.cells.push(new o.BasicCell({classes:["xcard-hits"]})),this.renderGolds()&&this.cells.push(new o.BasicCell({classes:["xcard-golds"]})),this.renderX()&&this.cells.push(new o.BasicCell({classes:["xcard-x"]})),this.cells.push(new o.BasicCell({classes:["xcard-row-total"]})),this.cells.push(new o.BasicCell({classes:["xcard-round-total"]}))},t.prototype.getCells=function(){return this.cells},t.prototype.getScoringCellsPerRow=function(){return this.shotsPerEnd<=3?6:12},t.prototype.getEndsPerRow=function(){return this.shotsPerEnd<=3?3:this.shotsPerEnd<=6?6:12},t.prototype.goldsDescriptor=function(){return this.options.goldsDescriptor},t.prototype.renderHits=function(){return this.options.withHits},t.prototype.renderGolds=function(){return this.options.withGolds},t.prototype.renderX=function(){return this.options.withX},t}()}.call(this),function(){var t=function(t,o){function n(){this.constructor=t}for(var i in o)s.call(o,i)&&(t[i]=o[i]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},s={}.hasOwnProperty;o.BasicCell=function(o){function s(t){null==t&&(t={}),s.__super__.constructor.call(this,t,"td")}return t(s,o),s}(o.BasicElement)}.call(this),function(){o.DistanceConfig=function(){function t(t){var o;null==t&&(t={}),this.options=Object.assign({distanceIndex:0,shotsPerEnd:6,title:"Distance",totalShots:36,withHits:!0,withGolds:!0,goldScore:10,withX:!0,recurveMatch:!1,compoundMatch:!1,withTotalHeaders:!0,titleCellSpan:null},t),this.goldScore=this.options.goldScore,this.shotsPerEnd=this.options.shotsPerEnd,this.totalShots=this.options.totalShots,this.title=this.options.title,this.withX=this.options.withX,this.withGolds=this.options.withGolds,this.goldScore=this.options.goldScore,this.withPoints=this.showPoints(),this.withHits=this.showHits(),this.withTotalHeaders=this.options.withTotalHeaders,this.numberOfEnds=this.totalShots/this.shotsPerEnd,this.endsPerRow=this.getEndsPerRow(),this.rowCount=this.getRowCount(),this.cellsPerEnd=this.getCellsPerEnd(),this.endTotalCells=1===this.endsPerRow?0:this.endsPerRow,this.titleCellSpan=null!=(o=this.options.titleCellSpan)?o:this.getTitleCellSpan()}return t.prototype.getCellsPerEnd=function(){return this.isMatch()?3:this.shotsPerEnd<=3?3:this.shotsPerEnd<=6?6:12},t.prototype.getEndsPerRow=function(){return this.isMatch()?1:this.shotsPerEnd<=6?2:1},t.prototype.getRowCount=function(){return this.isMatch()&&this.options.distanceIndex>0?3:this.numberOfEnds/this.endsPerRow},t.prototype.getTitleCellSpan=function(){return this.endsPerRow*this.cellsPerEnd+this.endTotalCells},t.prototype.isMatch=function(){return this.options.recurveMatch||this.options.compoundMatch},t.prototype.showHits=function(){return!(this.options.recurveMatch||this.options.compoundMatch)},t.prototype.showPoints=function(){return this.options.recurveMatch},t}()}.call(this),function(){o.DistanceHeaderRow=function(){function t(t){if(null==t&&(t={}),this.options=Object.assign({config:null},t),null==this.options.config)throw"DistanceHeaderRow requires DistanceConfig";this.config=this.options.config,this.cells=[this.getTitleCell()],this.config.endsPerRow>1&&this.cells.push(this.getRowTotalCell()),this.config.withHits&&this.cells.push(this.getRowHitsCell()),this.config.withGolds&&this.cells.push(this.getRowGoldsCell()),this.config.withX&&this.cells.push(this.getRowXCell()),this.config.withPoints&&this.cells.push(this.getRowPointsCell()),this.cells.push(this.getRunningTotalCell()),this.config.withPoints&&this.cells.push(this.getRunningTotalPointsCell())}return t.prototype.getTitleCell=function(){var t;return t=new o.BasicCell,t.setAttributes({colSpan:this.config.titleCellSpan,textContent:this.config.title,className:"title-cell"}),t},t.prototype.getEndTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({className:"end-total-cell"}),t},t.prototype.getRowGoldsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("g"),className:"row-golds-cell"}),t},t.prototype.getRowTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("rt"),className:"row-total-cell"}),t},t.prototype.getRowHitsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("h"),className:"row-hits-cell"}),t},t.prototype.getRowPointsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("pt"),className:"row-points-cell"}),t},t.prototype.getRowXCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("x"),className:"row-x-cell"}),t},t.prototype.getRunningTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("tot"),className:"running-total-cell"}),t},t.prototype.getRunningTotalPointsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay("tot pt"),className:"running-total-points-cell"}),t},t.prototype.forDisplay=function(t){return this.options.config.withTotalHeaders?t:""},t.prototype.toHtmlString=function(){return this.toHtml().outerHTML},t.prototype.toHtml=function(){var t,s,n,i,e;for(s=new o.BasicElement({className:"header-row"},"tr").toHtml(),e=this.cells.slice(0),n=0,i=e.length;i>n;n++)t=e[n],s.appendChild(t.toHtml());return s},t}()}.call(this),function(){o.DistanceTotalsRow=function(){function t(t){if(null==t&&(t={}),this.options=Object.assign({config:null,totals:null},t),null==this.options.config)throw"DistanceTotalsRow requires DistanceConfig";this.config=this.options.config,this.cells=[this.getSpacerCell()],this.options.config.withHits&&this.cells.push(this.getRowHitsCell()),this.options.config.withGolds&&this.cells.push(this.getRowGoldsCell()),this.options.config.withX&&this.cells.push(this.getRowXCell()),this.options.config.withPoints&&this.cells.push(this.getRowPointsCell()),this.cells.push(this.getRunningTotalCell()),this.options.config.withPoints&&this.cells.push(this.getRunningTotalPointsCell())}return t.prototype.getSpacerCell=function(){var t;return t=new o.BasicCell,t.setAttributes({colSpan:this.config.titleCellSpan+(this.config.endsPerRow>1?1:0),textContent:"",className:"totals-spacer"}),t},t.prototype.getEndTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({className:"end-total-cell"}),t},t.prototype.getRowGoldsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalGolds.toString()),className:"total-golds-cell"}),t},t.prototype.getRowTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:"rt",className:"row-total-cell"}),t},t.prototype.getRowHitsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalHits.toString()),className:"total-hits-cell"}),t},t.prototype.getRowPointsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalPoints.toString()),className:"total-points-cell"}),t},t.prototype.getRowXCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalX.toString()),className:"total-x-cell"}),t},t.prototype.getRunningTotalCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalScore.toString()),className:"total-score-cell"}),t},t.prototype.getRunningTotalPointsCell=function(){var t;return t=new o.BasicCell,t.setAttributes({textContent:this.forDisplay(this.options.totals.totalPoints.toString()),className:"total-points-cell"}),t},t.prototype.forDisplay=function(t){return this.options.totals.totalScore>0?t:""},t.prototype.toHtmlString=function(){return this.toHtml().outerHTML},t.prototype.toHtml=function(){var t,s,n,i,e;for(s=new o.BasicElement({className:"totals-row"},"tr").toHtml(),e=this.cells.slice(0),n=0,i=e.length;i>n;n++)t=e[n],s.appendChild(t.toHtml());return s},t}()}.call(this),function(){var t=function(t,o){function n(){this.constructor=t}for(var i in o)s.call(o,i)&&(t[i]=o[i]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},s={}.hasOwnProperty;o.ScoreCell=function(o){function s(t,o){var n,i;this.scoreData=null!=t?t:{},this.unused=null!=o?o:!1,s.__super__.constructor.call(this),this.scoreValue=null!=this.scoreData.score?parseInt(this.scoreData.score,10):null,this.isX=null!=(n=this.scoreData.isX)?n:!1,this.isGold=null!=(i=this.scoreData.isGold)?i:!1,this.text=this.scoreData.text,this.setAttributes({className:this.getClasses(),textContent:this.getTextContent(),data:{score:this.scoreValue}})}return t(s,o),s.prototype.getClasses=function(){var t;return t=["score-cell"],this.unused&&t.push("unused"),t.join(" ")},s.prototype.getTextContent=function(){return null==this.scoreValue?"":0===this.scoreValue?"m":null!=this.text?this.text:this.scoreValue},s.prototype.score=function(){var t;return null!=(t=this.scoreValue)?t:0},s}(o.BasicCell)}.call(this),function(){o.ScoringEnd=function(){function t(t){if(null==t&&(t={}),this.options=Object.assign({cellCount:3,scores:[],points:0,config:null},t),this.endTotalCell=null,null==this.options.config)throw"ScoringEnd requires DistanceConfig";this.build()}return t.prototype.build=function(){return this.buildScoringCells(),this.options.config.endsPerRow>1?this.buildEndTotalCell():void 0},t.prototype.buildScoringCells=function(){var t,s,n,i,e,l,r;for(this.scoringCells=[],e=[],t=s=1,n=this.options.cellCount;n>=1?n>=s:s>=n;t=n>=1?++s:--s)r=t>this.options.config.shotsPerEnd?!0:!1,l=null!=(i=this.options.scores[t-1])?i:{},e.push(this.scoringCells.push(new o.ScoreCell(l,r)));return e},t.prototype.buildEndTotalCell=function(){return this.endTotalCell=new o.EndTotalCell({config:this.options.config,scoringCells:this.scoringCells})},t.prototype.cells=function(){var t;return t=this.scoringCells.slice(0),null!=this.endTotalCell&&t.push(this.endTotalCell),t},t.prototype.hasAtLeastOneScore=function(){return this.scoringCells.filter(function(t){return null!=t.scoreValue}).length>0},t.prototype.totalHits=function(){return this.scoringCells.filter(function(t){return t.score()>0}).length},t.prototype.totalGolds=function(){var t;return t=this,this.scoringCells.reduce(function(o,s){return o+(s.score()===t.options.config.goldScore?1:0)},0)},t.prototype.totalScore=function(){return this.scoringCells.reduce(function(t,o){return t+=o.score()},0)},t.prototype.totalPoints=function(){return this.options.points},t}()}.call(this),function(){o.ScoringRow=function(){function t(t,o){if(null==t&&(t={}),this.endScoresData=null!=o?o:[],this.options=Object.assign({element:"tr",config:null,totals:null},t),null==this.options.config)throw"ScoringRow requires DistanceConfig";this.config=this.options.config,this.buildScoringEnds(),this.buildTotalsBlock()}return t.prototype.buildScoringEnds=function(){var t,s,n,i,e,l,r,c,a;for(this.scoringEnds=[],r=[],t=s=1,n=this.config.endsPerRow;n>=1?n>=s:s>=n;t=n>=1?++s:--s)c=null!=(i=this.endScoresData[t-1])?i:{},a=new o.ScoringEnd({config:this.config,cellCount:this.config.cellsPerEnd,scores:null!=(e=c.shots)?e:[],points:null!=(l=c.matchPoints)?l:0}),r.push(this.scoringEnds.push(a));return r},t.prototype.buildTotalsBlock=function(){return this.totalsBlock=new o.ScoringRowTotals({config:this.options.config,scoringEnds:this.scoringEnds,totals:this.options.totals})},t.prototype.toHtml=function(){var t,s,n,i,e,l,r,c,a,h,u,p,f;for(t=o.makeElement(this.options.element,{className:"scoring-row"}),c=this.scoringEnds,s=0,e=c.length;e>s;s++)for(f=c[s],a=f.cells(),n=0,l=a.length;l>n;n++)p=a[n],t.appendChild(p.toHtml());for(h=this.totalsBlock.cells,i=0,r=h.length;r>i;i++)u=h[i],t.appendChild(u.toHtml());return t},t}()}.call(this),function(){o.ScoringRowTotals=function(){function t(t){if(null==t&&(t={}),this.options=Object.assign({config:null,scoringEnds:[],totals:null},t),null==this.options.config)throw"ScoringRow totals requires DistanceConfig";this.scoringEnds=this.options.scoringEnds,this.displayTotals=this.ensureAtLeastOneScoringEnd(),this.buildTotals()}return t.prototype.buildTotals=function(){var t,s,n,i,e;return i=this.getRowTotalScore(),this.options.totals.totalScore+=i,s=this.getRowTotalHits(),this.options.totals.totalHits+=s,t=this.getRowTotalGolds(),this.options.totals.totalGolds+=t,e=this.getRowTotalX(),this.options.totals.totalX+=e,this.options.withPoints&&(n=this.getRowTotalPoints(),this.options.totals.totalPoints+=n),this.cells=[],this.scoringEnds.length>1&&this.cells.push(new o.BasicCell({className:"row-total-score row-totals",textContent:this.forDisplay(i)})),this.options.config.withHits&&this.cells.push(new o.BasicCell({className:"row-hits-total row-totals",textContent:this.forDisplay(s)})),this.options.config.withGolds&&this.cells.push(new o.BasicCell({className:"row-golds-total row-totals",textContent:this.forDisplay(t)})),this.options.config.withX&&this.cells.push(new o.BasicCell({className:"row-x-total row-totals",textContent:this.forDisplay(e)})),this.options.config.withPoints&&this.cells.push(new o.BasicCell({className:"row-points-total row-totals",textContent:this.forDisplay(n)})),this.cells.push(new o.BasicCell({className:"row-running-total row-totals",textContent:this.forDisplay(this.options.totals.totalScore)})),this.options.config.withPoints?this.cells.push(new o.BasicCell({className:"row-running-total-points row-totals",textContent:this.forDisplay(this.options.totals.totalPoints)})):void 0},t.prototype.cells=function(){return this.cells},t.prototype.ensureAtLeastOneScoringEnd=function(){return this.scoringEnds.filter(function(t){return t.hasAtLeastOneScore()}).length>0},t.prototype.forDisplay=function(t){return this.displayTotals?t.toString():""},t.prototype.getRowTotalGolds=function(){return this.scoringEnds.reduce(function(t,o){return t+o.totalGolds()},0)},t.prototype.getRowTotalX=function(){return 0},t.prototype.getRowTotalHits=function(){return this.scoringEnds.reduce(function(t,o){return t+o.totalHits()},0)},t.prototype.getRowTotalPoints=function(){return this.scoringEnds.reduce(function(t,o){return t+o.totalPoints()},0)},t.prototype.getRowTotalScore=function(){return this.scoringEnds.reduce(function(t,o){return t+o.totalScore()},0)},t}()}.call(this),function(){var t=function(t,o){function n(){this.constructor=t}for(var i in o)s.call(o,i)&&(t[i]=o[i]);return n.prototype=o.prototype,t.prototype=new n,t.__super__=o.prototype,t},s={}.hasOwnProperty;o.EndTotalCell=function(o){function s(t){var o;if(this.options=null!=t?t:{},null==this.options.config)throw"EndTotalCell requires DistanceConfig";this.scoringCells=null!=(o=this.options.scoringCells)?o:[],s.__super__.constructor.call(this,{className:"end-total-cell row-totals",textContent:this.textContent()})}return t(s,o),s.prototype.cellsInUse=function(){return this.scoringCells.filter(function(t){return!t.unused})},s.prototype.endIsScored=function(){var t;return t=this.scoringCells.filter(function(t){return null!=t.scoreValue}),t.length===this.cellsInUse().length},s.prototype.textContent=function(){return this.endIsScored()?this.totalScore().toString():""},s.prototype.totalGolds=function(){var t;return t=this,this.scoringCells.reduce(function(o,s){return o+(s.score()===t.options.config.goldScore?1:0)},0)},s.prototype.totalScore=function(){return this.scoringCells.reduce(function(t,o){return t+o.score()},0)},s}(o.BasicCell)}.call(this),function(){o.TargetDataAdapter=function(){function t(t,o){if(this.targetRoundDefinition=t,this.bowType=null!=o?o:"recurve",null==this.targetRoundDefinition)throw"Target Round definition is required";this.parseRoundDefinition(),this.ensureLeftPadding()}return t.prototype.ensureLeftPadding=function(){var t,o,s,n,i,e;for(i=this.distances,e=[],o=s=0,n=i.length;n>s;o=++s)t=i[o],e.push(this.distances[o].leftPaddingCellCount=2*(this.maxShotsPerEnd-t.shotsPerEnd));return e},t.prototype.parseRoundDefinition=function(){var t,o,s,n,i,e,l;for(this.distances=[],this.maxShotsPerEnd=0,e=this.targetRoundDefinition.distances,l=[],s=n=0,i=e.length;i>n;s=++n)t=e[s],o=this.distanceDefinition(t,s),this.distances.push(o),l.push(this.maxShotsPerEnd=o.shotsPerEnd>this.maxShotsPerEnd?o.shotsPerEnd:this.maxShotsPerEnd);return l},t.prototype.distanceDefinition=function(t,o){var s;return{distanceIndex:o,shotsPerEnd:this.toNumber(null!=(s=t.shots_per_end)?s:this.targetRoundDefinition.default_shots_per_end),title:this.title(t.range,o),totalShots:this.toNumber(t.total_shots),withHits:!0,withGolds:!0,goldScore:this.toNumber(this.targetRoundDefinition.scoring_scheme[0]),withX:this.withX(),recurveMatch:this.isRecurveMatchRound(),compoundMatch:this.isCompoundMatchRound(),withTotalHeaders:this.withTotalHeaders(o)}},t.prototype.isCompoundMatchRound=function(){return"compound"!==this.bowType?!1:this.isMatchRound()},t.prototype.isRecurveMatchRound=function(){return"compound"===this.bowType?!1:this.isMatchRound()},t.prototype.isMatchRound=function(){return this.targetRoundDefinition.short_name.match(/match/)},t.prototype.rangeUnit=function(){return"metric"===this.targetRoundDefinition.round_type?"m":"yd"},t.prototype.title=function(t,o){return this.isMatchRound()&&o>0?"Tie-break "+o:""+t+this.rangeUnit()},t.prototype.toNumber=function(t){return parseInt(t,10)},t.prototype.withTotalHeaders=function(){return!0},t.prototype.withX=function(){return"outdoor"===this.targetRoundDefinition.environment&&this.targetRoundDefinition.has_x},t}()}.call(this),function(){o.Totalizer=function(){function t(t){null==t&&(t={}),this.totalHits=this.totalScore=this.totalPoints=this.totalGolds=this.totalX=0}return t}()}.call(this),function(){}.call(this),function(){}.call(this)}).call(this),"object"==typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o)}).call(this);