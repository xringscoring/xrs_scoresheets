(function(){window.AutoScoring=function(){function r(){this.distanceSpec=[],this.error=null}return r.prototype.sumArray=function(r){return 0===r.length?0:r.reduce(function(r,t){return r+t})},r.prototype.adjustedScoresArray=function(r,t){return t&&r.push(0),r},r.prototype.autoScoreV2=function(r,t){var e,o,n,i,s,a,u,c,l,h,d,g,f,p;if(this.error=null,c=r.scoringScheme().toArray(),!this.validateScorePermissible(t,r.maxPossibleScore(),c))return null;if(e=this.getArrowValuesForScoreAndTotalShots(t,r.maxShots(),c),!e)return null;for(g=this.getSvgTarget(r),p=g.getTargetFaceCount(),d=this.shuffleArray(e),u=0,f=0,o=i=0,s=d.length-1;s>=0?s>=i:i>=s;o=s>=0?++i:--i)a=e[o],r.canAddDistance()?(r.addDistance(),f=0,u=0):r.canAddEnd()&&(r.addEnd(),f=0,u=0),n=this.getShotIdentifier(r,a,c),h=g.getAutoPlotFromScore(n,"t"+f),h.arrowId=r.arrowIds()[u],l=new window.ShootShot(h),r.addShot(l),u+=1,f=f===p-1?0:f+1;return r.totalScore()!==this.sumArray(d)?(this.error="Error compiling scores",null):!0},r.prototype.autoScore=function(r,t,e){var o,n,i,s,a,u,c,l,h,d,g,f,p,S,m,y,v,w,A;if(null==e&&(e=null),this.error=null,n=null!==e,A=r.targetRound,!this.validateScorePermissible(t,A.maxPossibleScore(),A.scoring_scheme))return null;if(o=this.getArrowValuesForScoreAndTotalShots(t,A.maxShots,A.scoring_scheme),!o)return null;for(n&&(y=window.ShootTargetData,m=y.load(r,e),v=y.buildTargetRings(m,A.scoring_scheme,r.xringEnabled())),g=0,S=this.shuffleArray(o),u=l=0,h=S.length-1;h>=0?h>=l:l>=h;u=h>=0?++l:--l)d=o[u],r.canAddShot()||(r.canAddEnd()&&r.addEnd(),r.canAddDistance()&&r.addDistance(),g=0),c=this.getShotIdentifier(r,d,A.scoring_scheme),p={score:d,arrowIdentifier:r.arrows[g],arrowIndex:g,cY:0,cX:0,is_x:("x"===c).toString()},n&&(w=v[c],a=w.getDistributedPointCoordinates(),i=window.TargetPlotterMobile.getPositionFromCenter(a[0],0,1,1)/200,s=window.TargetPlotterMobile.getPositionFromCenter(a[1],0,1,1)/200,p.cY=s,p.cX=i),f=new window.Shot(p),r.addShot(f),g+=1;return r.totalScore()!==this.sumArray(S)?(this.error="Error compiling scores",null):!0},r.prototype.bubbleDistribution=function(r,t,e,o){var n,i,s,a,u,c,l,h,d,g;for(n=a=1,l=r.length;l>=1?l>a:a>l;n=l>=1?++a:--a)for(i=u=0,h=r.length-n;h>=0?h>u:u>h;i=h>=0?++u:--u)if(r[i]-o>=t)for(s=c=d=i+1,g=r.length-1;(g>=d?g>c:c>g)&&(r[s]-o>=t&&r[s]+o<=e&&(r[i]-=o,r[s]+=o),r[i]!==t);s=g>=d?++c:--c);return r},r.prototype.divideToEvenNumber=function(r){return 1===r||0===r?r:2*Math.round(Math.floor(r/2)/2)},r.prototype.randomDistribution=function(r,t,e,o){var n,i,s,a,u,c,l,h,d;for(null==o&&(o=1),u={},d=0,l=[],n=s=0,i=r.length;i>s;n=++s)c=r[n],c>=t&&(l.push(n),d+=c-t,r[n]=t);for(;d>0;)a=this.getRandomNumber(l[0],l[l.length-1]),h=r[a]+o,e>=h&&h>=t&&(r[a]=h,d-=o);return r},r.prototype.getRandomNumber=function(r,t){return Math.floor(Math.random()*(t-r+1))+r},r.prototype.getArrowValuesForScoreAndTotalShots=function(r,t,e){var o,n,i,s,a,u,c,l,h,d;if(h=this,d=e[0]-e[1],i=!1,r%2!==0&&2===d&&(i=!0,t-=1),o=r/t,o>e[0])return this.error="Invalid score for this round",!1;if(o=Math.floor(o),0!==o?2===d&&o%2===0&&(o-=1):d=1,o===e[0]&&(o-=2*d),a=e[e.length-1],a>o&&(o=0),l=this.generatePopulatedArray(t,o),c=r-this.sumArray(l),c===r)return l=this.whenAverageScoreIsZero(l,r,e),l.reverse();if(c>0)for(n=s=0,u=t-1;u>=0?u>=s:s>=u;n=u>=0?++s:--s){if(l[n]<e[0]){for(;c>0&&(c-=d,l[n]+=d,l[n]!==e[0]););if(0===c)break}n===t-1&&(n=0)}return i&&l.push(0),this.siphonScores(l,e)},r.prototype.generatePopulatedArray=function(r,t){var e,o,n,i,s;for(e=new Array(r),n=s=0,i=e.length;i>s;n=++s)o=e[n],e[n]=t;return e},r.prototype.getScoreDistribution=function(r,t){var e;return e=this.getTargetRoundSpec(t),this.partitionDistanceScores(r,e)},r.prototype.getShotIdentifier=function(r,t,e){return r.xringEnabled()?10!==parseInt(e[0])?t:10!==t?t:this.getRandomBoolean()?"x":t:t},r.prototype.getRandomBoolean=function(){return Math.random()>=.5},r.prototype.getSvgTarget=function(r){var t,e,o,n;return e=r.scoringSchemeId(),t=new window.ScoringScheme(e,r.usingX()),o=r.targetFace().svgSelector(),n=new window.SvgTarget(o,{scoringScheme:t})},r.prototype.getTargetRoundSpec=function(r){var t,e,o,n,i;for(e=[],o=r.roundDistances().slice().reverse(),i=0,n=o.length;n>i;i++)t=o[i],e.push(t.maxPossibleScore());return e},r.prototype.getValidAverageScore=function(r,t,e){var o;for(o=Math.floor(r/t);o>0&&-1===e.indexOf(o);)o-=1;return o},r.prototype.partitionScoreForTargetRound=function(r,t){var e,o,n,i,s,a,u,c,l,h;for(h=this,o=this.getScoreDistribution(r,t).reverse(),u=t.roundDistances(),n=[],i=a=0,s=o.length;s>a;i=++a)c=o[i],e=u[i],l=this.getArrowValuesForScoreAndTotalShots(c,e.totalShots(),e.scoring()),n[i]=h.shuffleArray(l);return n},r.prototype.partitionDistanceScores=function(r,t){var e,o;for(e=this.generatePopulatedArray(t.length,0),o=0;r>0;)o===t.length&&(o=0),e[o]<t[o]&&(e[o]+=1,r-=1),o+=1;return e},r.prototype.scoringSchemeIsImperial=function(r){return 9===r[0]&&1===r[r.length-1]},r.prototype.siphonScores=function(r,t){var e,o,n,i;return i=t[0]-t[1],o=t[t.length-1],e=t[0],n=this.sortNumerically(r.slice(0)).reverse(),this.sortNumerically(this.randomDistribution(n,o,e,i))},r.prototype.sortNumerically=function(r){var t;return t=function(r,t){return t>r?-1:r>t?1:void 0},r.sort(t)},r.prototype.shuffleArray=function(r){var t,e,o;for(t=r.length;--t>0;)e=~~(Math.random()*(t+1)),o=r[e],r[e]=r[t],r[t]=o;return r},r.prototype.whenAverageScoreIsZero=function(r,t,e){var o,n,i,s,a,u;for(n=window.Knapsack,a=n.distribution(t,e),o=s=0,i=a.length;i>s;o=++s)u=a[o],r[o]=u;return r},r.prototype.validateScorePermissible=function(r,t,e){var o,n,i;return i=r+0,o=e[e.length-1],this.error=null,n="Score must be between "+o+" and "+t,(isNaN(i)||i>t)&&(this.error=n),this.validMinimumScore(i,o),null===this.error},r.prototype.validateDistanceScoresAgainstSpec=function(r,t){var e,o,n,i,s;for(o=this.getTargetRoundSpec(t),n=s=0,i=r.length;i>s;n=++s)if(e=r[n],e>o[n]||e<o[n]){this.error="Error splitting scores between distances";break}return null===this.error},r.prototype.validMinimumScore=function(r,t){var e;return r===t?!0:(e=t,6===t&&(e=2*t-1),t>r?(this.error="Score should be minimum of "+t,!1):r===e?(this.error=r+" is an invalid score for this round",!1):!0)},r}()}).call(this),function(){}.call(this);